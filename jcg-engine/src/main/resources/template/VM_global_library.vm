#**
* @author <a href="kayvanfar.sj@gmail.com">Saeed Kayvanfar</a> on 5/27/2106.
*#
## todo must move to other macro library
## ############################################################################ Hibernate Handler START

## Define id name
#macro(idName $id)
    @Id
    @GeneratedValue(strategy = GenerationType.#idGeneratorTypeHibernate($id.idGeneratorType))
    @Column(name = "${id.columnName}", unique = ${id.unique}, nullable = ${id.nullable})
    private ${id.type} ${id.name};
#end

## Define id setters and getters
#macro(idGetterAndSetter $id)
    #set($capitalizeName = ${id.name.substring(0, 1).toUpperCase()}+${id.name.substring(1)})   ## capitalize of property.name

    public ${id.type} get${capitalizeName}() {
        return ${id.name};
    }

    public void set${capitalizeName}(${id.type} ${id.name}) {
        this.${id.name} = ${id.name};
    }
#end

## Define properties name
#macro(propertiesName $properties)
    #foreach(${property} in ${properties})
    @Basic
    @Column(name = "${property.columnName}", unique = ${property.unique}, nullable = ${property.nullable})
    private ${property.type} ${property.name};
    #end
#end

## Define properties setters and getters
#macro(propertiesGetterAndSetter $properties)
    #foreach(${property} in ${properties})
    #set($capitalizeName = ${property.name.substring(0, 1).toUpperCase()}+${property.name.substring(1)})   ## capitalize of property.name

    public ${property.type} get${capitalizeName}() {
        return ${property.name};
    }

    public void set${capitalizeName}(${property.type} ${property.name}) {
        this.${property.name} = ${property.name};
    }
    #end
#end

## Define relationships name
#macro(relationshipsName $relationships)
    #foreach(${relationship} in ${relationships})
#relationshipCardinalityTypeHibernate($relationship.cardinalityType)#if((!${relationship.head} && ${relationship.cardinalityType} != "* ... 1") || (${relationship.directionalityType} == "Bidirectional") && ${relationship.cardinalityType} == "1 ... *")(mappedBy = "${relationship.otherSideRelationship.name}")#end

private #if(${relationship.collectionType} != "Nothing")${relationship.collectionType}<#end${relationship.targetEntity.name}#if($relationship.collectionType != "Nothing")>#end ${relationship.name};
    #end
#end

## Define relationships setters and getters
#macro(relationshipsGetterAndSetter $relationships)
    #foreach(${relationship} in ${entity.relationships})
    #set($capitalizeName = ${relationship.name.substring(0, 1).toUpperCase()}+${relationship.name.substring(1)})   ## capitalize of relation.name

    public #if(${relationship.collectionType} != "Nothing")${relationship.collectionType}<#end${relationship.targetEntity.name}#if($relationship.collectionType != "Nothing")>#end get${capitalizeName}() {
        return ${relationship.name};
    }

    public void set${capitalizeName}(#if(${relationship.collectionType} != "Nothing")${relationship.collectionType}<#end${relationship.targetEntity.name}#if($relationship.collectionType != "Nothing")>#end ${relationship.name}) {
        this.${relationship.name} = ${relationship.name};
    }
    #end
#end

## Define relationship cardinalityType for hibernate
#macro(relationshipCardinalityTypeHibernate $cardinalityType)
    #if(${cardinalityType} == "1 ... 1")
        @OneToOne
    #elseif(${cardinalityType} == "1 ... *")
        @OneToMany
    #elseif(${cardinalityType} == "* ... 1")
        @ManyToOne
    #elseif(${cardinalityType} == "* ... *")
        @ManyToMany
    #end
#end

## Define id generator type for hibernate todo must change
#macro(idGeneratorTypeHibernate $cardinalityType)
    #if(${cardinalityType} == "Auto")
        AUTO
    #elseif(${cardinalityType} == "Manual")

    #elseif(${cardinalityType} == "Incremental")
        SEQUENCE
    #elseif(${cardinalityType} == "Native")
        TABLE
    #end
#end

## ############################################################################ Hibernate Handler END

## ############################################################################ View START
## Define properties name
#macro(viewComponents $components $span)
    #set($Integer = 0)
    #set($realSpan = 12/$Integer.parseInt($span))   ## Calculate real span
    #foreach(${component} in ${components})
    <div class="column small-${realSpan} medium-${realSpan} large-${realSpan}">
        #set($call = "#${component.class.simpleName}")
        #evaluate($call)
    </div>
    #end
#end

## Components

## Define TextField component
#macro(TextField $component)
    <form:text path="${component.targetEntityElement.name}" placeholder="${component.targetEntityElement.labelName}" label="${component.targetEntityElement.labelName}" maxlength="${component.maxLength}"/>
#end

## Define TextArea component
#macro(TextArea $component)
<form:textarea path="${component.targetEntityElement.name}" placeholder="${component.targetEntityElement.labelName}" label="${component.targetEntityElement.labelName}"/>
#end

## Define PasswordTextField component
#macro(PasswordTextField $component)
<form:password path="${component.targetEntityElement.name}" placeholder="${component.targetEntityElement.labelName}" label="${component.targetEntityElement.labelName}"/>
#end

## Define Label component
#macro(Label $component)
<form:label path="${component.targetEntityElement.name}" label="${component.targetEntityElement.labelName}" content="#[[${displayData.]]#${component.targetEntityElement.name}}"/>
#end

## Define Link component
#macro(Link $component)
#set($url = ${component.targetView.getTargetEntity().getName().toLowerCase()} + "s/" + ${component.targetView.getViewFileName()})   ## lowerCase of targetView file name
<form:link name="${component.targetEntityElement.name}" label="${component.targetEntityElement.labelName}" url="${url}" idQuery="#[[${displayData.]]#${component.targetView.getTargetEntity().getName().toLowerCase()}Id}"/>
#end

## DataGrid headers
#macro(dataGridHeaders $dataGrid)
<tr class="my-panel-header">
        <th>ردیف</th>
    #foreach(${component} in ${dataGrid.components})
        <th>${component.targetEntityElement.labelName}</th>
    #end
    <th></th>
</tr>
#end

## DataGrid Contents
#macro(dataGridContents $view)
#set($entityName = ${view.targetEntity.name}) ## name
#set($lowerCaseViewFileName = ${view.viewFileName.substring(0, 1).toLowerCase()}+${view.viewFileName.substring(1)})   ## lowerCase of view file name
#set($lowerCaseEntityName = ${entityName.substring(0, 1).toLowerCase()}+${entityName.substring(1)})   ## lowerCase of entity name
<c:forEach var="${lowerCaseEntityName}" items="${${lowerCaseEntityName}s.data}" varStatus="forIndex">
    <tr>
        <td>${${lowerCaseEntityName}s.page * ${lowerCaseEntityName}s.pageSize + forIndex.index + 1}</td>
        #foreach(${component} in ${view.dataGrid.components})
            #set($call = "#${component.class.simpleName}")
            <td>#evaluate($call)</td>
        #end

        <td>
            <button href="#" data-dropdown="drop1" aria-controls="drop1" aria-expanded="false" class="button round dropdown">عملیات</button><br>
            <ul id="drop1" data-dropdown-content class="f-dropdown" aria-hidden="true">
                <li>
                    <a href="<filter:hashLongUrl url="/manage/user" name="id" value="${${lowerCaseEntityName}.${lowerCaseEntityName}Id}" />"
                    class="primary round button">
                    نمایش
                    </a>
                </li>
                <li>
                    <a href="<filter:hashLongUrl url="/manage/user" name="id" value="${${lowerCaseEntityName}.${lowerCaseEntityName}Id}" />"
                    class="success round button">
                    ویرایش
                    </a>
                </li>
                <li>
                    <a href="<filter:hashLongUrl url="/manage/artist" name="id" value="${${lowerCaseEntityName}.${lowerCaseEntityName}Id}" />"
                    class="alert round button">
                    حذف
                    </a>
                </li>
            </ul>
        </td>
    </tr>
</c:forEach>
#end


## Define Data properties name
#macro(dataPropertiesName $components)
    #foreach(${component} in ${components})
        #set($property = ${component.targetEntityElement})
        @SearchParam
        private ${property.type} ${property.name};
    #end
#end

## Define Data properties setters and getters
#macro(dataPropertiesGetterAndSetter $components)
    #foreach(${component} in ${components})
        #set($property = ${component.targetEntityElement})
        #set($capitalizeName = ${property.name.substring(0, 1).toUpperCase()}+${property.name.substring(1)})   ## capitalize of property.name

        public ${property.type} get${capitalizeName}() {
            return ${property.name};
        }

        public void set${capitalizeName}(${property.type} ${property.name}) {
            this.${property.name} = ${property.name};
        }
    #end
#end

## ############################################################################ Hibernate Handler END